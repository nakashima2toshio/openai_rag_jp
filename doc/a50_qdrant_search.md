# a50_qdrant_search.py

## 概要

QdrantベクトルデータベースでRAG検索を行うStreamlit Webアプリケーション。複数ドメインのQAデータに対してフィルタ検索、Named Vectorsの切り替え、スコア表示等の機能を提供する。

## 主な機能

- **Streamlit Web UI**: ブラウザベースの直感的なインターフェース
- **ドメインフィルタ**: customer/medical/legal/sciqから検索対象を絞り込み
- **Named Vectors切替**: 複数の埋め込みモデルを選択可能
- **質問例表示**: 各ドメインの典型的な質問を表示
- **スコア表示**: 検索結果の類似度スコアを表示
- **多言語対応**: 日本語質問で英語データを検索可能

## 起動方法

```bash
streamlit run a50_qdrant_search.py --server.port=8504
```

ブラウザで `http://localhost:8504` にアクセス

## UI構成

### サイドバー設定
- **Collection**: 使用するQdrantコレクション名
- **Using vector**: 使用するNamed Vector（埋め込みモデル）
- **Domain**: 検索対象ドメイン（ALL/customer/medical/legal/sciq）
- **TopK**: 上位検索結果数（1-20）
- **Qdrant URL**: QdrantサーバーのURL

### 質問例セクション
各ドメイン選択時に表示される典型的な質問例：

- **customer**: 返金、配送、アカウント関連
- **medical**: 副作用、症状、管理方法関連  
- **legal**: 利用規約、権利関連
- **sciq**: 科学、技術関連

### メイン画面
- **クエリ入力**: 検索したい質問を入力
- **Search ボタン**: 検索実行
- **結果表示**: スコア順で結果を表形式表示
- **最高スコア結果**: 最も類似度の高い結果を強調表示

## 多言語埋め込み機能

```
OpenAIのembeddingモデルが多言語対応のため、日本語質問と英語データが同じベクトル空間で比較可能
例：日本語「返金は可能ですか？」と英語「Can I get a refund?」の類似度が0.4957と高い値を示している
この多言語embedding機能により、翻訳なしで日英間の意味的検索が実現されている
```

## 設定ファイル連携

`config.yml`から設定を読み込み：

```yaml
rag:
  collection: "qa_corpus"

embeddings:
  primary:
    provider: "openai" 
    model: "text-embedding-3-small"
    dims: 1536

qdrant:
  url: "http://localhost:6333"
```

## 検索結果表示項目

| 項目 | 説明 |
|------|------|
| score | コサイン類似度スコア（0-1） |
| domain | データのドメイン分類 |
| question | 元の質問文 |
| answer | 対応する回答文 |
| source | 元CSVファイル名 |

## サンプル質問例

### Customer Support
- "返金は可能ですか？"
- "配送にはどのくらい時間がかかりますか？"
- "アカウントを作成するにはどうすればよいですか？"

### Medical
- "副作用はありますか？"
- "心房細動の症状について教えてください"
- "糖尿病の管理方法は何ですか？"

### Legal
- "Googleは私が作成したコンテンツに基づいて新しいコンテンツを作成することが許可されていますか？"
- "ユーザー生成コンテンツの修正からなる派生作品を作成することはGoogleの法的権利内ですか？"

### SciQ
- "チーズやヨーグルトなどの食品の調製に一般的に使用される生物のタイプは何ですか？"
- "放射性崩壊の最も危険性の低いタイプは何ですか？"
- "物質が酸素と迅速に反応するときに起こる反応の種類は何ですか？"

## 技術仕様

### 依存ライブラリ
- **streamlit**: Web UIフレームワーク
- **qdrant-client**: Qdrantクライアントライブラリ  
- **openai**: OpenAI API クライアント
- **pandas**: データフレーム処理
- **PyYAML**: 設定ファイル読み込み

### エラーハンドリング
- Qdrant接続エラー時の適切なエラー表示
- 設定ファイル読み込みエラー時のデフォルト値使用
- 検索結果が0件の場合の処理

### セッション状態管理  
- 質問例クリック時の自動入力
- UI状態の保持

## カスタマイズポイント

- 質問例の追加・変更
- UI レイアウトの調整
- 検索結果表示項目の追加
- ドメイン分類の拡張
- 多言語UI対応